## Lemon

This is a snapshot of the standard [lemon
parser](https://sqlite.org/src/doc/trunk/doc/lemon.html) included as
[part of sqlite](https://www.sqlite.org/lemon.html)
with a few minor modifications (described below).

## Reasons for patching

Various projects that have attempted to port the lemon parser to use
C++ containers etc. However, this approach is likely not very
sustainable and will obviously significantly from the original C
version, which is bad for long-term maintenance.

After attempting a few ideas, instead settled on a creating a mininal
set of changes that allow lemon to integrate more nicely into a C++
framework with an absolute minimum of changes to the original code.

1. Alternative output file extension (`-e` option) <br/>
   Allows generated output to trigger C++ instead of C make rules.

2. File-static linking of parser components (`%static` keyword) <br/>
   The lemon parser components are changed to have file-static linkage
   and thus _"hides"_ them from the global symbol table.


A typical coding pattern would be to designate all of the lemon parser
components static (using the `%static` grammar rule provided by this
set of patches) and exposing the "proper" C++ methods within
a `%code { }` block.

To emphasize the changes, the set of patches is also maintained within
the repository.


## Example usage

Lemon has been successfully integrated into
[OpenFOAM](https://openfoam.com) to add expression handling
for a variety of CFD field types.

The
[field expression](https://gitlab.com/openfoam/openfoam/-/blob/master/src/OpenFOAM/expressions/fields/fieldExprLemonParser.lyy-m4)
example, illustrates the generation of lemon production rules
with [m4](https://www.gnu.org/software/m4/) macros and isolation (hiding)
of the parser components from the member functions.


### Snippets for documentation

3.1 Command-line options:

* -eextension

  Output code extension, the default is 'c'.
  Changing this will not change the type of code generated (it will
  still be C) but it does allow triggering of different make rules
  or diffferent compiler types.


3.2.2  Interface Summary

Notes:

* Use the %name directive to change the "Parse" prefix names of the
  procedures in the interface.

* Use the %static directive to change the interface type defined by
  YYFUNCAPI to file `static` linkage. This can be useful if the entire
  parser code is to be locally wrapped inside of a different caller.



4.4  Special directives

* %static


4.4.xxx The %static directive

By default, the functions generated by Lemon are exposed as globally
visible symbols. You can change this by specifying the %static
directive.

This places parser routines in a static (ie, file-local) scope so that
they are not visible outside of the compilation unit. The parser
routines will then be wrapped with some other type of mechanism.
